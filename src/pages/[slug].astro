---
import { getCollection } from 'astro:content';
import Pattern from '../components/Pattern.astro';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro'

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  // pubDateでソート
  const sortedArticles = articles.sort((a, b) => {
    return new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime();
  });
  
  return sortedArticles.map((article, index) => {
    // 現在の記事のインデックスを取得
    const currentIndex = sortedArticles.findIndex(a => a.id === article.id);
    // 前後の記事を取得（存在しない場合は undefined）
    const prevArticle = currentIndex < sortedArticles.length - 1 ? sortedArticles[currentIndex + 1] : undefined;
    const nextArticle = currentIndex > 0 ? sortedArticles[currentIndex - 1] : undefined;

    return {
      params: { slug: article.id.replace('.md', '') },
      props: {
        article,
        prevArticle,
        nextArticle,
      },
    };
  });
}

const { article, prevArticle, nextArticle } = Astro.props;
---

<Layout title={article.data.title}>
  <Header />
  <Pattern
    article={article}
    prevArticle={prevArticle}
    nextArticle={nextArticle}
  />
</Layout> 