---
interface Props {
  baseName: string;
  title: string;
  enableSwitching?: boolean;
}

const { baseName, title, enableSwitching = true } = Astro.props;

// SVGファイルのパスを生成
const pixelSvgPath = `${import.meta.env.BASE_URL}assets/${baseName}_pixel.svg`;
const pixelWithGridSvgPath = `${import.meta.env.BASE_URL}assets/${baseName}_pixel-with-grid.svg`;
const patternSvgPath = `${import.meta.env.BASE_URL}assets/${baseName}_pattern.svg`;
---

<div class="pattern-container" data-enable-switching={enableSwitching}>
  <img
    src={pixelSvgPath}
    alt={`${title} pixel art`}
    class="w-full h-auto"
    data-pattern-type="pixel"
  />
  <img
    src={pixelWithGridSvgPath}
    alt={`${title} pixel art with grid`}
    class="w-full h-auto hidden"
    data-pattern-type="pixel-with-grid"
  />
  <img
    src={patternSvgPath}
    alt={`${title} pattern`}
    class="w-full h-auto hidden"
    data-pattern-type="pattern"
  />
</div>

<script>
  // 各コンポーネントで独立して状態を管理
  let currentType = 'pixel';
  const types = ['pixel', 'pixel-with-grid', 'pattern'];

  // クリックイベントの設定
  document.querySelectorAll('.pattern-container').forEach((container) => {
    const enableSwitching = container.getAttribute('data-enable-switching') === 'true';
    
    if (enableSwitching) {
      (container as HTMLElement).style.cursor = 'pointer';
      container.addEventListener('click', () => {
        // 現在のタイプのインデックスを取得
        const currentIndex = types.indexOf(currentType);
        // 次のタイプを計算（最後の場合は最初に戻る）
        const nextIndex = (currentIndex + 1) % types.length;
        currentType = types[nextIndex];

        // すべての画像を非表示にしてから、現在のタイプの画像のみを表示
        const images = container.querySelectorAll('img[data-pattern-type]');
        images.forEach((img) => {
          if (img.getAttribute('data-pattern-type') === currentType) {
            img.classList.remove('hidden');
          } else {
            img.classList.add('hidden');
          }
        });
      });
    }
  });
</script>