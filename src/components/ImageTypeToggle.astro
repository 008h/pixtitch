---
import { getCurrentImageType } from '../utils/imageType';
import crossStitchIcon from '../assets/images/switch_cross-stitch.svg?url';
import pixelIcon from '../assets/images/switch_pixel.svg?url';
import patternIcon from '../assets/images/switch_pattern.svg?url';

const currentType = getCurrentImageType();
---

<div class="tabs tabs-boxed fixed bottom-4 right-4">
  <button
    id="type-cross-stitch"
    class="tab flex items-center gap-1"
    aria-label="クロスステッチ"
  >
    <img src={crossStitchIcon} alt="クロスステッチ" class="w-8 h-8" data-type="cross-stitch" />
    <span class="text-xs">stitch</span>
  </button>
  <button
    id="type-pixel"
    class="tab flex items-center gap-1"
    aria-label="ピクセルアート"
  >
    <img src={pixelIcon} alt="ピクセルアート" class="w-8 h-8" data-type="pixel" />
    <span class="text-xs">pixel</span>
  </button>
  <button
    id="type-pattern"
    class="tab flex items-center gap-1"
    aria-label="パターン"
  >
    <img src={patternIcon} alt="パターン" class="w-8 h-8" data-type="pattern" />
    <span class="text-xs">pattern</span>
  </button>
</div>

<script>
  import { setImageType, getCurrentImageType } from '../utils/imageType';

  const types = ['cross-stitch', 'pixel', 'pattern'] as const;
  let currentType = getCurrentImageType();

  // 初期状態の設定
  document.addEventListener('DOMContentLoaded', () => {
    // 現在のタイプのタブをアクティブにする
    const activeTab = document.querySelector(`[data-type="${currentType}"]`);
    if (activeTab) {
      activeTab.classList.add('tab-active');
    }

    // すべての画像コンテナを更新
    document.querySelectorAll('.pattern-container').forEach((container) => {
      const images = container.querySelectorAll('img[data-type]');
      images.forEach((img) => {
        if (img.getAttribute('data-type') === currentType) {
          img.classList.remove('hidden');
        } else {
          img.classList.add('hidden');
        }
      });
    });
  });

  // クリックイベントの設定
  document.querySelectorAll('.tab').forEach((tab) => {
    tab.addEventListener('click', () => {
      const type = tab.getAttribute('data-type') as typeof types[number];
      if (type) {
        // すべてのタブからアクティブクラスを削除
        document.querySelectorAll('.tab').forEach((t) => {
          t.classList.remove('tab-active');
        });
        // クリックされたタブをアクティブにする
        tab.classList.add('tab-active');
        currentType = type;
        
        // カスタムイベントを発火
        const event = new CustomEvent('imageTypeChange', {
          detail: { type }
        });
        document.dispatchEvent(event);
        
        setImageType(currentType);
      }
    });
  });
</script> 